# Pipeline for bullseyeindexbroadcast by Gufran Ye≈üilyurt

trigger:
  branches:
    include:
    - master
  paths:
    include:
    - 'bullseyeindexbroadcast/'

pool:
  name: Default

steps:
  - task: CMake@1
    inputs:
      workingDirectory: './bullseyeindexbroadcast'
      cmakeArgs: '-G Ninja -B ./build -S . -DCMAKE_TOOLCHAIN_FILE=/home/gufranyes/vcpkg/scripts/buildsystems/vcpkg.cmake -DCMAKE_CXX_COMPILER=/usr/bin/clang++'

  - task: Bash@3
    displayName: Bash Script
    inputs:
      workingDirectory: './bullseyeindexbroadcast'
      targetType: inline
      script: |
        cd ./build
        ninja
  # Run clang-tidy
  - task: Bash@3
    inputs:
      workingDirectory: './bullseyeindexbroadcast'
      targetType: 'inline'
      script: |
        clang-tidy -p ./build -- -std=c++17 ./*.cc
    displayName: 'Run clang-tidy'

  # Publish clang-tidy report as a test run
  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '$(Build.SourcesDirectory)/bullseyeindexbroadcast/build/compile_commands.json'
    displayName: 'Publish clang-tidy report'
