# Pipeline for bullseyeindexbroadcast by Gufran Ye≈üilyurt

trigger:
  branches:
    include:
    - master
  paths:
    include:
    - 'bullseyeindexbroadcast/'

pool:
  name: Default

stages:
  - stage: Test
    jobs:
    - job: CMakeConfiguration
      steps:
        - task: CMake@1
          inputs:
            workingDirectory: './bullseyeindexbroadcast'
            cmakeArgs: '-G Ninja -B ./build -S . -DCMAKE_TOOLCHAIN_FILE=/home/gufranyes/vcpkg/scripts/buildsystems/vcpkg.cmake -DCMAKE_CXX_COMPILER=/usr/bin/clang++ -DCMAKE_EXPORT_COMPILE_COMMANDS=ON'
    - job: Clangtidy
      steps:
        - task: Bash@3
          inputs:
            targetType: 'inline'
            script: |
              clang-tidy -p $(Build.SourcesDirectory)/bullseyeindexbroadcast/build -extra-arg-before=-std=c++17 $(Build.SourcesDirectory)/bullseyeindexbroadcast/bullseyeindexbroadcast.cc
  - stage: LogFailedTest
    condition: failed()
    jobs:
    - job: PublishResults
      steps:
        - task: PublishTestResults@2
          inputs:
            testResultsFiles: '$(Build.SourcesDirectory)/bullseyeindexbroadcast/build/compile_commands.json'
      displayName: 'Publish clang-tidy report'
  
  - stage: Build
    dependsOn: Test
    jobs: 
    - job: NinjaBuild
      steps:
        - task: Bash@3
          inputs:
            workingDirectory: './bullseyeindexbroadcast'
            targetType: inline
            script: |
              cd ./build
              ninja    
